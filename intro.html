<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CHAOS tutorials: Introduction to the CHAOS.Portal Javascript client</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="CHAOS.Portal.Client.PortalClient.js" type="text/javascript"></script>

    <link rel="stylesheet" type="text/css" href="http://cdn.jsdelivr.net/codemirror/3.0/codemirror.css">
    <script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.0/codemirror.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.0/mode/javascript/javascript.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.0/mode/css/css.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.0/mode/xml/xml.js"></script>
    <!-- htmlmixed depends on xml and css -->
    <script type="text/javascript" src="http://cdn.jsdelivr.net/codemirror/3.0/mode/htmlmixed/htmlmixed.js"></script>

    <link href="style.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="script.js"></script>
  </head>
  <body>
    <!-- Representation of code in HTML is for some reason weird but it seems consensus is
    <pre><code>CODE</code></pre>
    Check: http://stackoverflow.com/questions/4611591/code-vs-pre-vs-samp-for-inline-and-block-code-snippets
    -->

    <div id="body-column">
      <h1>Tutorial: CHAOS.Portal Javascript Client</h1>
      <h2>The first steps</h2>
      <p id="intro">
        The <dfn>CHAOS.Portal Javascript Client</dfn> is a communication client for
        <dfn>CHAOS.Portal</dfn><br>
        <dfn>CHAOS.Portal</dfn> is the web API for <a
          href="http://chaos-community.org"><dfn><abbr title="Cultural Heritage
            Archiving Open System">CHAOS</abbr></dfn></a>.<br>
      </p>
      <p>
        Javascript client for CHAOS.Portal is one of the easiest ways to start
        using CHAOS.<br>
        <br>
        This tutorial will teach you how to set up the client, connect to a
        CHAOS.Portal and retrieve object from the CHAOS database.
      </p>
      <aside class="note">
        <p>
          Double-click on any code to select it -- this makes for easy copying
          and pasting.
        </p>
      </aside>

      <section>
      <h3>Setting up</h3>
      <p>
      Import the Javascript CHAOS.Portal Client into your site.
      </p>

      <aside class="code">
      <pre><code class="language-html">&lt;script src="CHAOS.Portal.Client.PortalClient.js" type="text/javascript"&gt;&lt;/script&gt;</code></pre>
      </aside>

      <aside class="note">
        <p>
          All following code examples will be Javascript code, and should be
          included in your page between
          <code>&lt;script&gt;&lt;/script&gt;</code> tags or otherwise imported
          as Javascript into your site.

          Double-click on any code to select it: for easy Copy/Paste.
        </p>
      </aside>

      <p>
        The first thing we need to do is to instantiate the client.
      </p>

      <aside class="code">
      <pre><code id="setup" class="language-javascript">// Setup settings
var ChaosSettings = {
  "servicePath":"http://api.chaos-systems.com/",
  //"clientGUID":"9f62060c-64ff-e14f-a8d5-d85a1e2e21b8",
  "accessPointGUID":"C4C2B8DA-A980-11E1-814B-02CEA2621172",
};
// Instantiate client
var client = new PortalClient(
                   ChaosSettings.servicePath,
                   ChaosSettings.clientGUID
                 );</code></pre>
      </aside>

      <p>
        <code>servicePath</code> is the URL at which your CHAOS.Portal
        is set up.
      </p>

      <p> Instantiating the <code>PortalClient</code> this way automatically
      sets up a session. When the session has been set up we are ready to use
      the CHAOS.Portal.<br>
      <br>
      We can add callbacks to <code>PortalClient.SessionAcquired()</code> in
      order to do work when the session has been set up:
      <!-- Next we need to set up a session. Session are for logging in with some -->
      <!-- user on the CHAOS.Portal server and thereby authenticating yourself with the -->
      <!-- server. In this case we don't need to login, and a session is automatically -->
      <!-- created for us. -->

      <!-- When the session is created, we are ready to grab objects from the CHAOS -->
      <!-- server. We can add event handlers to the SessionAcquired() event &#45; these -->
      <!-- will be called when a session has been set up for us. -->
      </p>

      <aside class="code">
      <pre><code class="language-javascript eval">client.SessionAcquired().Add(function(sender, sessionGUID) {
  alert("Session created: " + sessionGUID);
});</code></pre>
<!--       <pre><code class="language&#45;javascript">setTimeout(function() { -->
<!--   client.SessionAcquired().Add(function(sender, sessionGUID) { -->
<!--     alert("Session created: " + sessionGUID); -->
<!--   }); -->
<!-- }, 2000);</code></pre> -->
      </aside>

      <p>Now we are ready to get some objects!</p>
      </section>

      <section>
      <h3>Searching</h3>
      <p>
        The easiest way to retrieve some objects from a CHAOS database is to
        search.
      </p>

      <aside class="code">
      <pre><code class="language-javascript eval">// Add search schemas
ChaosSettings.schemas = [
  "5906a41b-feae-48db-bfb7-714b3e105396",
  "00000000-0000-0000-0000-000063c30000",
  "00000000-0000-0000-0000-000065c30000"
];
// Retrieve objects
client.SessionAcquired().Add(function(sender, sessionGUID) {
  client.Object_GetBySearch(
    showObjects                     // callback
    , "mut"                         // query
    , ChaosSettings.schemas         // schemas
    , "da"                          // langCode
    , null                          // sort
    , ChaosSettings.accessPointGUID // accessPointGuid
    , 0                             // pageIndex
    , 3                             // pageSize
    , true                          // includeMetadata
    , true                          // includeFiles
    , true                          // includeObjectRelations
    , false                         // includeAccessPoints
  );
});

function showObjects(serviceResult) {
  var count = serviceResult.MCM().Count();
  var totalcount = serviceResult.MCM().TotalCount();
  alert("Got " + count + "/" + totalcount + " objects");
}</code></pre>
      </aside>

      <p>
        When the search results has been recieved from the CHAOS.Portal, the
        callback is invoked with <code>serviceResult</code> as its argument.
        The <code>serviceResult</code> has a number of fields, of which
        <code>MCM()</code> is the most important and the one we are going to be
        using.
      </p>

      <p>
        Now the resulting objects are quite big, so let's only grab one, by
        setting pageSize to 1:
      </p>

      <aside class="code">
      <pre><code class="language-javascript eval">// Retrieve objects
client.SessionAcquired().Add(function(sender, sessionGUID) {
  client.Object_GetBySearch(
    showObjects                     // callback
    , "mut"                         // query
    , "5906a41b-feae-48db-bfb7-714b3e105396" // schemas
    , "da"                          // langCode
    , null                          // sort
    , ChaosSettings.accessPointGUID // accessPointGuid
    , 0                             // pageIndex
    , 1                             // pageSize
    , true                          // includeMetadata
    , true                          // includeFiles
    , true                          // includeObjectRelations
    , false                         // includeAccessPoints
  );
});

function showObjects(serviceResult) {
  var json_result = serviceResult.MCM().Results();

  // The code below is simply for showing you the JSON results
  var string_result = JSON.stringify(json_result, null, '\t').replace('&lt;', '&amp;lt;').replace('&gt;', '&amp;gt;')
  $('#search-results').data('codeMirror').setValue(string_result);
}</code></pre>
      </aside>

      <p>And the results are...:</p>
      <aside class="code" id="search-results">
      <pre><code class="language-json">
// The result should look something like this
[
	{
		"GUID": "00000000-0000-0000-0000-00004e040016",
		"ObjectTypeID": 36,
		"DateCreated": -2147483648,
		"Metadatas": [
			{
				"GUID": "29d669cf-c3e5-4749-beb9-20bb7ac18b05",
				"EditingUserGUID": "80d15fb4-c1fb-9445-89c6-1a398cbd85e5",
				"LanguageCode": "da",
				"MetadataSchemaGUID": "5906a41b-feae-48db-bfb7-714b3e105396",
				"RevisionID": 1,
        "MetadataXML": "&lt;some&gt;&lt;xml&gt;&lt;data&gt;&lt;/data&gt;&lt;/xml&gt;&lt;/some&gt;",
				"DateCreated": -2147483648,
				"FullName": "CHAOS.MCM.Data.DTO.Metadata"
      }
      //, ... more metadata
		],
		"Files": [
			{
				"ID": 506457,
				"ParentID": null,
				"Filename": "db_fo_sa_00564.jpg",
				"OriginalFilename": "db_fo_sa_00564.jpg",
				"Token": "HTTP Download",
				"URL": "http://example.org/some/url/to/a/file.jpg",
				"FormatID": 42,
				"Format": "KB Source JPEG ",
				"FormatCategory": "Image Source",
				"FormatType": "Image",
				"FullName": "CHAOS.MCM.Data.DTO.FileInfo"
			}
      //, ... more files
		],
		"ObjectRelations": [],
		"FullName": "CHAOS.MCM.Data.DTO.Object"
	}
]
      </code></pre>
      </aside>
      <p> What you can see here is that we get a list of objects. Each object
      has a GUID and an ObjectTypeID. Furthermore we can see that each object
      has a list of files and a list of metadata.</p>
    </section>

      <footer>
        <p>The next section will teach you how to use files and metadata.</p>
        <a class="prev-page" href="index.html">&larr; Back up: Overview
          </a>
        <a class="next-page" href="metadata.html">Next up: Using metadata and
          files &rarr;</a>
        <!-- &raquo; / &laquo; -->
      </footer>
    </div>
  </body>
</html>
